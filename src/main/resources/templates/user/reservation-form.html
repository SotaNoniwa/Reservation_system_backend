<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .calendar-container {
            width: 300px;
            margin: 20px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border-radius: 10px 10px 0 0;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            padding: 10px;
        }
        .day {
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
        }
        .day:hover {
            background-color: #ddd;
        }
        .disabled {
            color: #ccc;
            pointer-events: none;
        }
        .selected {
            background-color: #28a745;
            color: white;
        }
        .weekday-header {
            font-weight: bold;
            background-color: #ddd;
            padding: 5px;
            text-align: center;
        }
    </style>
</head>
<body>

<h3>Make a reservation</h3>

<form method="post" action="#" th:action="@{/user/reservation}" th:object="${reservation}">
    <select th:field=*{course.id}>
        <option th:each="c : ${courses}" th:value="${c.id}" th:text="${c.name}"></option>
    </select>
    <br><br>
    <div class="calendar-container">
        <div class="calendar-header">
            <button id="prevMonth">&lt;</button>
            <span id="monthYear"></span>
            <button id="nextMonth">&gt;</button>
        </div>
        <div class="calendar-grid" id="calendar">
            <!-- Weekdays will be added here -->
            <div class="weekday-header">Sun</div>
            <div class="weekday-header">Mon</div>
            <div class="weekday-header">Tue</div>
            <div class="weekday-header">Wed</div>
            <div class="weekday-header">Thu</div>
            <div class="weekday-header">Fri</div>
            <div class="weekday-header">Sat</div>
            <!-- Dates will be generated here -->
        </div>
    </div>
    <br><br>
    Start time: <select id="startTimeInput"></select>
    <br><br>
    Number of people: <input type="text" th:field="*{numOfPeople}" value="1">
    <br><br>
    Note: <input type="text" th:field="*{note}" value="blah...">
    <br><br>
    <input type="hidden" name="startTime" id="selectedDateTimeInput" th:field="*{startTime}">
    <input type="submit" value="Submit">
</form>

</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const startTimeInput = document.getElementById("startTimeInput");
        const selectedDateTimeInput = document.getElementById("selectedDateTimeInput");

        let selectedDate = null;
        let selectedTime = "10:00";

        function updateSelectedDateTime() {
            if (selectedDate && selectedTime) {
                document.getElementById("selectedDateTimeInput").value = `${selectedDate}T${selectedTime}`;
                console.log("Updated LocalDateTime:", document.getElementById("selectedDateTimeInput").value);
            } else {
                console.log("Waiting for both date and time to be selected...");
            }
        }

        function generateTimeOptions() {
            let optionsHtml = "";
            const startHour = 10;
            const endHour = 18;

            for (let hour = startHour; hour < endHour; hour++) {
                for (let minutes of [0, 15, 30, 45]) {
                    let time = `${String(hour).padStart(2, "0")}:${String(minutes).padStart(2, "0")}`;
                    optionsHtml += `<option value="${time}">${time}</option>`;
                }
            }
            let lastTime = `${String(endHour).padStart(2, "0")}:${String(0).padStart(2, "0")}`;
            optionsHtml += `<option value="${lastTime}">${lastTime}</option>`;

            startTimeInput.innerHTML = optionsHtml;
        }

        generateTimeOptions();

        // Update selected time
        startTimeInput.addEventListener("change", function (event) {
            selectedTime = event.target.value;
            console.log("selected time: ", selectedTime);
            updateSelectedDateTime();
        });

        // Calendar logic
        const today = new Date();
        const minDate = new Date(today);
        minDate.setDate(today.getDate() + 2); // 2 days later
        const maxDate = new Date(today);
        maxDate.setDate(today.getDate() + 30); // 1 month later

        let currentDate = new Date(minDate.getFullYear(), minDate.getMonth(), 1);

        function renderCalendar() {
            const monthYear = document.getElementById("monthYear");
            const calendarGrid = document.getElementById("calendar");

            calendarGrid.innerHTML = `
                <div class="weekday-header">Sun</div>
                <div class="weekday-header">Mon</div>
                <div class="weekday-header">Tue</div>
                <div class="weekday-header">Wed</div>
                <div class="weekday-header">Thu</div>
                <div class="weekday-header">Fri</div>
                <div class="weekday-header">Sat</div>
            `;

            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            monthYear.textContent = `${year} / ${month + 1}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.innerHTML += `<div></div>`;
            }

            for (let day = 1; day <= daysInMonth; day++) {
                let date = new Date(year, month, day, 12);
                let dayElement = document.createElement("div");
                dayElement.className = "day";
                dayElement.textContent = day;

                if (date < minDate || date > maxDate) {
                    dayElement.classList.add("disabled");
                } else {
                    dayElement.addEventListener("click", function () {
                        document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));
                        dayElement.classList.add("selected");

                        selectedDate = date.toISOString().split("T")[0]; // Store the selected date
                        console.log("Selected Date:", selectedDate);
                        updateSelectedDateTime();
                    });
                }

                calendarGrid.appendChild(dayElement);
            }
        }

        document.getElementById("prevMonth").addEventListener("click", function (event) {
            event.preventDefault();
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById("nextMonth").addEventListener("click", function (event) {
            event.preventDefault();
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        renderCalendar();
    });
</script>

</html>